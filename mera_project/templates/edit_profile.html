{% load static %}
<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Edit Profile | My App</title>
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
  <style>
    * { box-sizing: border-box; }
    body, html {
      margin: 0; padding: 0; height: 100%;
      font-family: 'Poppins', sans-serif;
      background: radial-gradient(circle at top left, #0a0f1f, #0e1a2b, #152942);
      color: #fff; overflow: hidden;
      display: flex; justify-content: center; align-items: center; flex-direction: column;
    }
    .bg-glow {
      position: absolute; width: 300px; height: 300px; border-radius: 50%;
      filter: blur(120px); opacity: 0.6; animation: float 8s ease-in-out infinite alternate;
    }
    .bg-glow.one { background: #00ffc3; top: 10%; left: 15%; }
    .bg-glow.two { background: #007bff; bottom: 15%; right: 20%; }
    @keyframes float { 0%{transform:translate(0,0);}100%{transform:translate(40px,40px);} }

    h1.welcome {
      font-size: 3rem; font-weight: 800; color: #00ffc3;
      text-shadow: 0 0 25px rgba(0,255,195,0.8);
      letter-spacing: 2px; margin-bottom: 40px; text-align: center;
    }

    .glass-card {
      background: rgba(255,255,255,0.08);
      border: 1px solid rgba(255,255,255,0.15);
      backdrop-filter: blur(20px);
      border-radius: 20px;
      padding: 50px 70px;
      text-align: center;
      box-shadow: 0 0 30px rgba(0,255,195,0.15);
      width: 90%;
      max-width: 700px;
      position: relative;
    }

    .avatar {
      width: 100px; height: 100px; border-radius: 50%;
      display: flex; align-items: center; justify-content: center;
      font-size: 36px; font-weight: 700; color: white;
      margin: 0 auto 20px auto;
      background: linear-gradient(135deg,#00ffc3,#007bff);
      box-shadow: 0 0 20px rgba(0,255,195,0.3);
      border: 3px solid rgba(255,255,255,0.3);
    }

    h2 { font-weight: 700; color: #00ffc3; margin-bottom: 25px; }

    .form-control {
      border-radius: 10px; background: rgba(255,255,255,0.1);
      color: #fff; border: 1px solid rgba(255,255,255,0.2);
      padding: 10px; margin-bottom: 15px;
    }

    .form-control:focus {
      background: rgba(255,255,255,0.2);
      box-shadow: 0 0 15px #00ffc3; border-color: #00ffc3;
    }

    .btn-custom { border-radius: 30px; padding: 12px 25px; font-weight: 600; width: 45%; }
    .btn-save { background: linear-gradient(135deg,#00ffc3,#00bfff); color: #000; border:none; }
    .btn-cancel { background: rgba(255,0,0,0.8); color: #fff; border:none; }

    /* ‚úÖ Tick animation */
    .success-checkmark {
      width: 80px; height: 80px; border-radius: 50%; display: none;
      stroke-width: 4; stroke: #00ffc3; stroke-miterlimit: 10;
      position: absolute; left: 50%; top: 50%;
      transform: translate(-50%, -50%) scale(0);
      opacity: 0; animation: none;
    }

    .show-checkmark {
      display: block; animation: popIn 0.6s ease-out forwards;
    }

    @keyframes popIn {
      0% { transform: translate(-50%, -50%) scale(0.5); opacity: 0; }
      80% { transform: translate(-50%, -50%) scale(1.1); opacity: 1; }
      100% { transform: translate(-50%, -50%) scale(1); opacity: 1; }
    }
  </style>
</head>
<body>

  <div class="bg-glow one"></div>
  <div class="bg-glow two"></div>

  <h1 class="welcome">üåü WELCOME {{ user_name|default:"User" }} üåü</h1>

  <div class="glass-card">
    <svg class="success-checkmark" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 52 52">
      <circle cx="26" cy="26" r="25" fill="none" />
      <path fill="none" d="M14 27l7 7 16-16" />
    </svg>

    <div class="avatar">{{ user_name|slice:":1" }}</div>
    <h2>‚úèÔ∏è Edit Profile</h2>

    <form id="editForm" method="POST">
      {% csrf_token %}
      <div class="text-start w-100">
        <label for="name">Full Name</label>
        <input type="text" class="form-control" id="name" name="name" value="{{ user_name }}" required>
      </div>

      <div class="text-start w-100">
        <label for="email">Email Address</label>
        <input type="email" class="form-control" id="email" name="email" value="{{ user_email }}" required>
      </div>

      <div class="mt-4 d-flex justify-content-between">
        <button type="submit" class="btn btn-save btn-custom">üíæ Save</button>
        <a href="{% url 'welcome' %}" class="btn btn-cancel btn-custom">üö™ Cancel</a>
      </div>
    </form>
  </div>

  <script>
    document.getElementById("editForm").addEventListener("submit", async function(e) {
      e.preventDefault(); // stop normal reload
      const form = e.target;
      const formData = new FormData(form);
      const csrfToken = form.querySelector("[name=csrfmiddlewaretoken]").value;
      const checkmark = document.querySelector(".success-checkmark");

      try {
        const response = await fetch("", {
          method: "POST",
          headers: { "X-CSRFToken": csrfToken },
          body: formData
        });

        if (response.ok) {
          checkmark.classList.add("show-checkmark");
          setTimeout(() => {
            window.location.href = "{% url 'welcome' %}";
          }, 1800);
        } else {
          alert("Something went wrong while saving!");
        }
      } catch (error) {
        alert("Error saving profile!");
      }
    });
  </script>

</body>
</html>
